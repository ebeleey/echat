# 챗봇 검증용 질문 예시

> 하이브리드 검색 및 할루시네이션 방지 로직 검증을 위한 테스트 케이스

## 📋 테스트 카테고리

1. [정확한 질문](#1-정확한-질문-데이터셋에-있는-질문-그대로)
2. [유사한 질문](#2-유사한-질문-의미는-같지만-표현이-다른)
3. [키워드 매칭 질문](#3-키워드-매칭-질문-핵심-키워드만-포함)
4. [특수문자 포함 질문](#4-특수문자-포함-질문)
5. [조사가 붙은 질문](#5-조사가-붙은-질문)
6. [짧은 질문](#6-짧은-질문)
7. [오타/변형 질문](#7-오타변형-질문)
8. [할루시네이션 방지 테스트](#8-할루시네이션-방지-테스트-데이터셋에-없는-질문)
9. [애매한 경우 테스트](#9-애매한-경우-테스트)

---

## 1. 정확한 질문 (데이터셋에 있는 질문 그대로)

**예상 결과**: ✅ 높은 점수로 답변 반환

```
Perso.ai에서 지원하는 언어는 몇 개인가요?
Perso.ai의 요금제는 어떻게 구성되어 있나요?
Perso.ai를 사용하는 주요 고객층은 누구인가요?
Perso.ai 웹사이트 하단의 '문의하기' 버튼을 통해 이메일 또는 채팅으로 고객센터에 문의할 수 있습니다.
이스트소프트는 어떤 회사인가요?
이스트소프트는 언제 설립되었나요?
```

**검증 포인트:**
- Vector Score: 높음 (0.9+)
- Keyword Score: 높음 (0.8+)
- Lexical Score: 높음 (0.8+)
- 최종 점수: 높음 (0.7+)
- ✅ 답변 반환

---

## 2. 유사한 질문 (의미는 같지만 표현이 다른)

**예상 결과**: ✅ 답변 반환 (벡터 검색으로 매칭)

```
Perso.ai가 뭐야?
Perso.ai는 무엇인가요?
Perso.ai에 대해 알려주세요.
Perso.ai가 무엇인지 궁금합니다.
이스트소프트가 어떤 회사인지 알고 싶어요.
이스트소프트 회사 정보를 알려주세요.
```

**검증 포인트:**
- Vector Score: 높음 (0.8+)
- Keyword Score: 중간 (0.3-0.7)
- Lexical Score: 중간 (0.3-0.6)
- 최종 점수: 중간 이상 (0.4+)
- ✅ 답변 반환

---

## 3. 키워드 매칭 질문 (핵심 키워드만 포함)

**예상 결과**: ✅ 키워드 보너스로 답변 반환

```
요금제?
요금제 알려주세요
요금제가 궁금합니다
지원 언어는 몇 개?
지원 언어 알려주세요
주요 기능은?
주요 기능 알려주세요
고객층은 누구인가요?
고객층이 궁금해요
```

**검증 포인트:**
- Vector Score: 낮음 (0.0-0.5)
- Keyword Score: 높음 (0.5+)
- Lexical Score: 낮음 (0.0-0.3)
- 키워드 보너스: 적용됨
- 최종 점수: 중간 이상 (0.3+)
- ✅ 답변 반환

---

## 4. 특수문자 포함 질문

**예상 결과**: ✅ 특수문자 키워드 매칭으로 답변 반환

```
perso.ai가 뭐야?
perso.ai는 무엇인가요?
perso.ai에 대해 알려주세요
Perso.ai가 뭔가요?
persoai가 뭐야?
perso ai가 뭐야?
```

**검증 포인트:**
- Vector Score: 높음 (0.8+)
- Keyword Score: 높음 (0.7+) - "perso.ai" 매칭
- Lexical Score: 중간 (0.2-0.5)
- 최종 점수: 높음 (0.5+)
- ✅ 답변 반환

---

## 5. 조사가 붙은 질문

**예상 결과**: ✅ 조사 제거 후 키워드 매칭으로 답변 반환

```
요금제가 궁금합니다
요금제는 어떻게 되나요?
요금제를 알려주세요
지원 언어는 몇 개인가요?
지원 언어가 궁금해요
주요 기능을 알려주세요
주요 기능이 뭐야?
```

**검증 포인트:**
- Vector Score: 낮음-중간 (0.0-0.6)
- Keyword Score: 중간-높음 (0.5+) - "요금제", "지원언어" 매칭
- Lexical Score: 낮음-중간 (0.0-0.3)
- 조사 처리: "요금제가" → "요금제" 매칭 성공
- 최종 점수: 중간 이상 (0.3+)
- ✅ 답변 반환

---

## 6. 짧은 질문

**예상 결과**: ✅ 키워드 매칭으로 답변 반환

```
요금제?
요금제!
요금제
지원 언어?
주요 기능?
고객층?
이스트소프트?
Perso.ai?
```

**검증 포인트:**
- Vector Score: 낮음-중간 (0.0-0.6)
- Keyword Score: 높음 (0.7+) - 핵심 키워드만 매칭
- Lexical Score: 낮음 (0.0-0.2)
- 최종 점수: 중간 이상 (0.3+)
- ✅ 답변 반환

---

## 7. 오타/변형 질문

**예상 결과**: ✅ Fuzzy 매칭으로 답변 반환

```
이스트 소프트는?
이스트소프트는?
이스트소프트가무야?
이스트 소프트가 뭐야?
잇스트소프트는?
ESTsoft는?
요금제 알려줘!
요금제 알려주세요
요금제 알려줄래?
```

**검증 포인트:**
- Vector Score: 중간-높음 (0.6+)
- Keyword Score: 중간-높음 (0.5+) - Fuzzy 매칭
- Lexical Score: 중간 (0.3-0.6)
- 최종 점수: 중간 이상 (0.4+)
- ✅ 답변 반환

---

## 8. 할루시네이션 방지 테스트 (데이터셋에 없는 질문)

**예상 결과**: ❌ "데이터에 없습니다" 반환

### A. 완전히 다른 주제

```
오늘 날씨가 어때?
점심 뭐 먹지?
내일 비 올까?
오늘 기분이 어때?
안녕하세요
ㅇㅇ
```

**검증 포인트:**
- Vector Score: 낮음 (0.0-0.5)
- Keyword Score: 0.000
- Lexical Score: 매우 낮음 (0.0-0.1)
- 최종 점수: 낮음 (0.0-0.2)
- ❌ "데이터에 없습니다" 반환

### B. 유사하지만 다른 질문

```
영상편집 지식이 필요해?
회원가입이 필요해?
로그인이 필요해?
결제는 어떻게 하나요?
환불은 어떻게 하나요?
```

**검증 포인트:**
- Vector Score: 중간-높음 (0.7+) - 의미적으로 유사
- Keyword Score: 낮음 (0.0-0.3) - 핵심 키워드 불일치
- Lexical Score: 낮음 (0.1-0.3)
- 최종 점수: 낮음 (0.0-0.3)
- Margin: 부족 (1위와 2위 점수 비슷)
- ❌ "데이터에 없습니다" 반환

### C. 관련 있지만 정확하지 않은 질문

```
Perso.ai는 무료인가요?
Perso.ai는 한국어만 지원하나요?
Perso.ai는 모바일 앱이 있나요?
이스트소프트는 몇 명이 근무하나요?
이스트소프트는 어디에 위치하나요?
```

**검증 포인트:**
- Vector Score: 중간 (0.6-0.8)
- Keyword Score: 중간 (0.3-0.6)
- Lexical Score: 낮음 (0.1-0.3)
- 최종 점수: 낮음-중간 (0.2-0.4)
- ❌ "데이터에 없습니다" 반환 (임계값 미달 또는 margin 부족)

---

## 9. 애매한 경우 테스트

**예상 결과**: Margin 체크로 거부 또는 허용

### A. 1위와 2위 점수 비슷한 경우

```
Perso.ai는?
Perso.ai에 대해
Perso.ai 정보
```

**검증 포인트:**
- Vector Score: 중간 (0.6-0.8)
- Keyword Score: 높음 (0.7+)
- Lexical Score: 중간 (0.3-0.6)
- 최종 점수: 중간 (0.4-0.6)
- Margin: 부족 (1위와 2위 차이 < 0.1)
- ✅ 키워드 점수 높으면 margin 완화 → 답변 반환 가능
- ❌ 키워드 점수 낮으면 margin 부족 → 거부 가능

### B. 점수가 임계값 근처인 경우

```
요금제가 궁금합니다
지원 언어는?
주요 기능을 알려주세요
```

**검증 포인트:**
- Vector Score: 낮음 (0.0-0.5)
- Keyword Score: 중간 (0.5+)
- Lexical Score: 낮음 (0.0-0.3)
- 최종 점수: 임계값 근처 (0.25-0.35)
- 신뢰도: 키워드 0.5 이상이면 높음
- Margin: 키워드 높으면 완화
- ✅ 키워드 보너스 + 신뢰도 높음 → 답변 반환 가능

---

## 📊 테스트 체크리스트

각 질문에 대해 다음을 확인하세요:

### ✅ 정상 케이스 (답변 반환)
- [ ] 정확한 질문 → 높은 점수로 답변 반환
- [ ] 유사한 질문 → 벡터 검색으로 답변 반환
- [ ] 키워드만 매칭 → 키워드 보너스로 답변 반환
- [ ] 특수문자 포함 → 특수문자 키워드 매칭 성공
- [ ] 조사가 붙은 질문 → 조사 제거 후 매칭 성공
- [ ] 짧은 질문 → 키워드 매칭으로 답변 반환
- [ ] 오타/변형 → Fuzzy 매칭으로 답변 반환

### ❌ 할루시네이션 방지 (거부)
- [ ] 완전히 다른 주제 → "데이터에 없습니다" 반환
- [ ] 유사하지만 다른 질문 → Margin 부족으로 거부
- [ ] 관련 있지만 정확하지 않은 질문 → 임계값 미달로 거부

### ⚠️ 애매한 경우
- [ ] 1위와 2위 점수 비슷 → Margin 체크로 판단
- [ ] 점수가 임계값 근처 → 신뢰도와 Margin으로 판단

---

## 🧪 테스트 실행 방법

### 1. 로컬 테스트

```bash
# 개발 서버 실행
pnpm dev

# 브라우저에서 질문 입력하여 테스트
# 또는 API 직접 호출
```

### 2. API 직접 테스트

```bash
curl -X POST http://localhost:3000/api/ask \
  -H "Content-Type: application/json" \
  -d '{"question": "요금제가 궁금합니다"}'
```

### 3. 로그 확인

서버 콘솔에서 다음 로그 확인:
```
[하이브리드 검색] 질문: "..." - 최종점수: X.XXX (벡터: X.XXX, 키워드: X.XXX, lexical: X.XXX) 신뢰도: 높음/보통 margin: ✓/✗
```

---

## 📈 예상 점수 분포

### 정상 답변 반환 케이스

| 질문 유형 | Vector | Keyword | Lexical | Final | 결과 |
|---------|--------|---------|---------|-------|------|
| 정확한 질문 | 0.9+ | 0.8+ | 0.8+ | 0.8+ | ✅ |
| 유사한 질문 | 0.8+ | 0.3-0.7 | 0.3-0.6 | 0.5+ | ✅ |
| 키워드만 | 0.0-0.5 | 0.5+ | 0.0-0.3 | 0.3+ | ✅ |
| 특수문자 | 0.8+ | 0.7+ | 0.2-0.5 | 0.5+ | ✅ |
| 조사 포함 | 0.0-0.6 | 0.5+ | 0.0-0.3 | 0.3+ | ✅ |

### 할루시네이션 방지 케이스

| 질문 유형 | Vector | Keyword | Lexical | Final | 결과 |
|---------|--------|---------|---------|-------|------|
| 다른 주제 | 0.0-0.5 | 0.000 | 0.0-0.1 | 0.0-0.2 | ❌ |
| 유사하지만 다름 | 0.7+ | 0.0-0.3 | 0.1-0.3 | 0.0-0.3 | ❌ |
| 관련 있지만 부정확 | 0.6-0.8 | 0.3-0.6 | 0.1-0.3 | 0.2-0.4 | ❌ |

---

## 💡 테스트 시 주의사항

1. **로그 확인 필수**: 각 점수(Vector, Keyword, Lexical, Final)를 확인하여 예상대로 작동하는지 검증
2. **Margin 체크**: 1위와 2위 점수 차이가 충분한지 확인
3. **신뢰도 판단**: 키워드 점수 0.5 이상이면 신뢰도 높음으로 판단되는지 확인
4. **할루시네이션 방지**: 데이터셋에 없는 질문은 반드시 "데이터에 없습니다" 반환
5. **키워드 보너스**: 키워드 점수 0.5 이상일 때 보너스가 적용되는지 확인

---

## 🎯 핵심 검증 포인트

### ✅ 성공 케이스
- 정확한 질문 → 높은 점수로 답변
- 키워드 매칭 → 보너스로 답변
- 조사 처리 → "요금제가" → "요금제" 매칭
- 특수문자 → "perso.ai" 매칭

### ❌ 실패 케이스 (의도된 거부)
- 다른 주제 → "데이터에 없습니다"
- 유사하지만 다름 → Margin 부족으로 거부
- 관련 있지만 부정확 → 임계값 미달로 거부

### ⚠️ 경계 케이스
- 점수 임계값 근처 → 신뢰도와 Margin으로 판단
- 1위와 2위 비슷 → Margin 체크로 판단

